var CMPAY_EGRET=function(){function e(){}function t(){for(var e=r.length,t=0;e>t;++t)r[t]();r.length=0}function n(){function e(e){var t;try{t=JSON.stringify(e).replace(/"/g,"`")}catch(n){return!1}return console.log("ssss:runtime-send:"+t),egret.ExternalInterface.call("newWebViewInstance",JSON.stringify({action:"callWebViewMethod",data:{methodName:"egretRuntimeOnMessage",paramStr:t}})),!0}function n(t,n){var a;if(n&&"object"==typeof n&&"number"==typeof(a=n.length))for(var o="on"===t,r="off"===t,s=0;a>s;++s){var c=n[s];if("function"==typeof c){var l=String(Math.random());r?delete i[l]:i[l]={isPersist:o,fn:c},n[s]={token:l}}}e({type:"cmpay_invoke",args:n,method:t})}function a(e){for(var t=[],n=e.length,a=0;n>a;++a)t.push(e[a]);return t}var r=!1;"boolean"==typeof CMPAY_DEBUG?r=CMPAY_DEBUG:CMPAY_DEBUG=!1,console.log("ssss:initOld:"+r);var i={};egret.ExternalInterface.addCallback("webview_to_runtime_js_data",function(e){console.log("ssss:runtime-recv:"+e);var n;try{n=JSON.parse(e)}catch(a){return}if(n&&n.type)switch(n.type){case"cmpay_loaded":return o.isReady=!0,void t();case"cmpay_invoke":var r,s=n.token;return void(s&&i.hasOwnProperty(s)&&i[s]&&"function"==typeof(r=i[s].fn)&&(i[s].isPersist||delete i[s],r.apply(null,n.args)))}});var s="http://game.liebao.cn/game/pay/part/cmpay-runtime-proxy-egret.html?";s+="_t="+Math.floor(Date.now()/3600/24/1e3),r&&(s+="&debug=1"),egret.ExternalInterface.call("newWebViewInstance",JSON.stringify({action:"createHiddenWebView",data:{url:s}})),console.log("ssss:runtime-create:"+s);for(var c=["on","off","fire","purchase"],l=c.length-1;l>-1;--l)!function(e){o[e]=function(){n(e,a(arguments))}}(c[l])}function a(){function e(e,t){var n=String(Math.random());egret.ExternalInterface.addCallback("wsj_pay",function(e){var a;try{a=JSON.parse(e)}catch(o){}if(a&&a.token===n){var r;try{r=JSON.parse(a.response)}catch(o){}t(r)}}),console.log("tttt:wsj_pay:"+JSON.stringify({token:n,request:e})),egret.ExternalInterface.call("wsj_pay",JSON.stringify({token:n,request:JSON.stringify(e)}))}function n(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var a=e[n],o=typeof a;("number"===o||"string"===o||"boolean"===o)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}return t.join("&")}function a(e,t){var a=new egret.URLLoader,o=new egret.URLRequest;e.method&&"post"===e.method.toLowerCase()&&(o.method=egret.URLRequestMethod.POST);var r="";e.data&&(r="string"==typeof e.data?e.data:n(e.data),o.data=new egret.URLVariables(r)),o.url=e.url,a.dataFormat=egret.URLLoaderDataFormat.TEXT,a.addEventListener(egret.Event.COMPLETE,function(){console.log("tttt:netreq:complete:"+a.data),t(a.data)}),console.log("tttt:netreq:"+o.url+":"+r),a.load(o)}function r(e,t){console.log("ssss:placeOrderProxy:"+JSON.stringify(e));var o=e.data&&e.data.access_token;if(o)if(32===o.length||"sdk"===o.slice(0,3)){var r={token:o,method:e.pay_method,dev:e.debug?1:null},i=e.data;for(var s in i)i.hasOwnProperty(s)&&"access_token"!==s&&(r[s]=i[s]);a({method:"POST",url:"http://gclogin.liebao.cn/api/native/order/pay",data:r},t)}else a({method:"POST",url:"http://gc.liebao.cn/pay/topay.php",data:{method:e.pay_method,args:n(e.data),dev:e.debug?1:null}},t);else t(!1,-1,'{"msg":"Token not provided."}')}function i(e,t){r(e,function(e){var n,a=!1,o="Unkown error";if(e){e=e.replace(/"transaction_id":(\d+)/,'"transaction_id":"$1"');try{n=JSON.parse(e),a=!0}catch(r){o="Empty response"}}var i=a&&n&&n.data&&n.data.args&&n.data.args.goodsTokenUrl&&1===n.ret;if(i){var s=n.data.args.goodsTokenUrl;o=s?"ok":"Empty goods token url"}t(i,i?0:n?n.ret:-1,o,n)})}var s=!1;"boolean"==typeof CMPAY_DEBUG?s=CMPAY_DEBUG:CMPAY_DEBUG=!1,console.log("ssss:initNew:"+s);var c={};o.on=function(e,t){var n;n=c.hasOwnProperty(e)?c[e]:c[e]=[],n.push(t)},o.off=function(e,t){var n;c.hasOwnProperty(e)&&(n=c[e]);for(var a=n.length,o=0;a>o;++o)n[o]===t&&n.splice(o,1)},o.fire=function(e){if(c.hasOwnProperty(e))for(var t=[].slice.call(arguments,1),n=c[e],a=n.length,o=n.slice(),r=0;a>r;++r){var i=o[r];try{i.apply(null,t)}catch(s){}}},o.isReady=!0,o.purchase=function(t){console.log("ssss:purchase:"+JSON.stringify(t)),i({pay_method:"wsjpay/sdk",data:t,debug:"undefined"!=typeof t.debug?t.debug:s},function(t,n,a,r){o.fire("cmpay_order_placed",{type:"cmpay_order_placed",transaction_id:r&&r.data?r.data.transaction_id:null,ret:n,msg:a,success:t,response:r}),t?e(r.data.args,function(e){var t=e&&"number"==typeof e.resultCode?e.resultCode:-99,n=e&&0===e.resultCode;o.fire("cmpay_order_complete",{type:"cmpay_order_complete",transaction_id:r.data.transaction_id,ret:t,success:n,payed:n,paid:n,wsjResponse:e})}):o.fire("cmpay_order_complete",{type:"cmpay_order_complete",transaction_id:r&&r.data?r.data.transaction_id:null,ret:-99,success:!1,payed:!1,paid:!1,wsjResponse:null})})},t()}var o={on:e,off:e,ready:e,isReady:!1,fire:e,purchase:e,getVersion:e,type:"egret_runtime"},r=[];o.ready=function(e){o.isReady?e():r.push(e)};var i=!1;o.getVersion=function(){return i};var s=egret.setTimeout(function(){i===!1?n():a()},null,100);return egret.ExternalInterface.addCallback("get_game_sdk_version",function(e){egret.clearTimeout(s),console.log("ssss:get_game_sdk_version:"+JSON.stringify(arguments)),i=e,a()}),egret.ExternalInterface.call("get_game_sdk_version",""),o}(),CMGAME_EGRET=function(){function e(e,t){var n=!1,a=!1,o=egret.setTimeout(function(){a||(a=!0,t(n))},null,e);egret.ExternalInterface.addCallback("get_game_sdk_version",function(e){console.log("ssss:get_game_sdk_version"+JSON.stringify(arguments)),egret.clearTimeout(o),a||(a=!0,n=e,t(n))}),egret.ExternalInterface.call("get_game_sdk_version","")}var t={};return t.checkIsGameSDK=function(){var t=!1,n=!0,a=-1,o=!1,r=[];return function(i){if(t)egret.setTimeout(function(){i(n,a)},null,1);else if(r.push(i),!o){o=!0;var s=function(){t=!0,egret.setTimeout(function(){console.log("sssstttt:CMGAME.checkIsGameSDK call listeners"),o=!1;for(var e=0;e<r.length;++e)try{r[e](n,a)}catch(t){console.log(t)}r.length=0},null,1)};console.log("sssstttt:get_game_sdk_version()"),e(1e4,function(e){console.log("sssstttt:get_game_sdk_version():"+JSON.stringify(arguments)),e&&!isNaN(e)&&(a=e),s()})}}}(),t.saveShortcutInfo=function(e){egret.ExternalInterface.call("save_shortcut_info",JSON.stringify({token:String(Math.random()),value:JSON.stringify(e)}))},t.pushIcon=function(e){e.title=e.Title,e.detailUrl=e.DetailUrl,e.picUrl=e.PicUrl,egret.ExternalInterface.call("push_icon",JSON.stringify(e))},t.dispatchGameLoginData=function(){var e;return egret.ExternalInterface.addCallback("dispatchGameLoginData",function(t){if(console.log("sssstttt:dispatchGameLoginData:callback:"+t),e){var n=!1;if("string"==typeof t)try{n=JSON.parse(t)}catch(a){}else n=t;e(n)}}),function(t,n){var a=e;e=function(t){e=a,n(t)},egret.ExternalInterface.call("dispatchGameLoginData",JSON.stringify(t))}}(),t.getGameSDKDeviceID=function(){throw"Method not exists, use CMGAME_LAYA.getGameSDKDeviceIDAsync() instead."},t.getGameSDKDeviceIDAsync=function(){var e;return egret.ExternalInterface.addCallback("get_device_info",function(t){if(e){var n=!1;if("string"==typeof t)try{n=JSON.parse(t)}catch(a){}else n=t;e(n)}}),function(t){var n=e;e=function(a){e=n,t(a)},egret.ExternalInterface.call("get_device_info","")}}(),t}(),__define=this.__define||function(e,t,n,a){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n,set:a})},nest;!function(e){var t;!function(t){function n(e,t){t({result:0})}function a(t,n){var a={module:"core",action:"callCustomMethod",param:t};e.callRuntime(a,n)}t.startup=n,t.callCustomMethod=a}(t=e.core||(e.core={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){function n(t,n){var a={module:"user",action:"checkLogin",param:t};e.callRuntime(a,n)}function a(t,n){var a={module:"user",action:"login",param:t};e.callRuntime(a,n,!0)}function o(t,n){var a=egret_native.getOption("egret.runtime.nest");if(a>=4||"custom"==a){var o={module:"user",action:"logout",param:t};e.callRuntime(o,n)}else n({result:0})}function r(t){var n={module:"user",action:"isSupport"};e.callRuntime(n,t)}t.checkLogin=n,t.login=a,t.logout=o,t.isSupport=r}(t=e.user||(e.user={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){function n(t,n){var a={module:"iap",action:"pay",param:t};e.callRuntime(a,n)}t.pay=n}(t=e.iap||(e.iap={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){function n(t){var n={module:"share",action:"isSupport"};e.callRuntime(n,t)}function a(t,n){var a={module:"share",action:"share",param:t};e.callRuntime(a,n,!0)}t.isSupport=n,t.share=a}(t=e.share||(e.share={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){function n(t){var n={module:"social",action:"isSupport"};e.callRuntime(n,t)}function a(t,n){var a={module:"social",action:"getFriends",param:t};e.callRuntime(a,n)}function o(t,n){var a={module:"social",action:"openBBS",param:t};e.callRuntime(a,n)}t.isSupport=n,t.getFriends=a,t.openBBS=o}(t=e.social||(e.social={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){function n(t){var n={module:"app",action:"isSupport"};e.callRuntime(n,t)}function a(t,n){var a={module:"app",action:"attention",param:t};e.callRuntime(a,n)}function o(t,n){var a={module:"app",action:"exitGame",param:t};e.callRuntime(a,n)}function r(t,n){var a={module:"app",action:"sendToDesktop",param:t};e.callRuntime(a,n)}t.isSupport=n,t.attention=a,t.exitGame=o,t.sendToDesktop=r}(t=e.app||(e.app={}))}(nest||(nest={}));var nest;!function(e){function t(e,t,o){void 0===o&&(o=!1);var r="nest";o?(egret.ExternalInterface.addCallback(r,function(e){console.log(e);var n=JSON.parse(e);t(n.data)}),egret.ExternalInterface.call(r,JSON.stringify(e))):(a.push({data:e,callback:t}),n())}function n(){if(a.length){if(o)return;o=!0;var e=a.shift(),t="nest";egret.ExternalInterface.addCallback(t,function(t){console.log(t);var a=JSON.parse(t);e.callback(a.data),o=!1,n()}),egret.ExternalInterface.call(t,JSON.stringify(e.data))}}var a=[];e.callRuntime=t;var o=!1}(nest||(nest={}));var __define=this.__define||function(e,t,n,a){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n,set:a})},nest;!function(e){var t;!function(e){function t(e,t){var n;if(n=egret.localStorage.getItem("deviceid")){if(console.log("cm old local deviceid "+n),n.indexOf("{")>=0){var a=JSON.parse(n);e.postData.deviceid=a.did}else e.postData.deviceid=n;r(e.postData,t)}else{console.log("cm old CMPAY_EGRET.version "+CMPAY_EGRET.getVersion());var o=0==CMPAY_EGRET.getVersion()||0==CMPAY_EGRET.getVersion()?"getUid":"get_device_info",i=!1,s=function(n){i||(i=!0,console.log(n),e.postData.deviceid=n||egret.localStorage.getItem("deviceid")||"",r(e.postData,t))};egret.ExternalInterface.addCallback(o,function(e){if(console.log("cm old CMPAY_EGRET"),"get_device_info"==o)if(console.log("cm old get_device_info "+e),e){var t=JSON.parse(e);s(t.did)}else s(null);else s(e)}),egret.setTimeout(function(){console.log("cm old timeout"),s(null)},this,2e3),egret.ExternalInterface.call(o,"")}}function n(e){var t={},n="http://api.egret-labs.org/games/www/getAppInfo.php/";n+=appId+"_"+spId,t.debug=1,i(n,t,egret.URLRequestMethod.GET,function(t){e(t)})}function a(e,t,n){var a={};a.access_token=e.access_token,a.openid=e.openid;var o="http://api.egret-labs.org/games/www/game.php/";o+=appId+"_"+spId,a.runtime=1,a.showGame=1,n&&(a.newLiebaoApi=1),i(o,a,egret.URLRequestMethod.GET,function(e){t(e)})}function o(e,t){var n="http://api.egret-labs.org/games/api.php",a={action:"pay.buy",id:egretInfo.egretUserId,appId:appId,time:Date.now(),runtime:1};for(var o in e)a[o]=e[o];i(n,a,egret.URLRequestMethod.GET,function(e){t(e)})}function r(e,t){var n="http://gclogin.liebao.cn/api/user/quick_register";i(n,e,egret.URLRequestMethod.POST,t)}function i(e,t,n,a){var o="";for(var r in t)o+=r+"="+t[r]+"&";""!=o&&(o=o.substr(0,o.length-1)),console.log("cm old solution ="+e+"?"+o);var i=new egret.URLLoader;i.addEventListener(egret.Event.COMPLETE,function(){console.log("cm old solution  ="+i.data);var e=JSON.parse(i.data);a(e)},this);var s=new egret.URLRequest(e);s.method=n,s.data=new egret.URLVariables(o),i.load(s)}e.callRuntime=t,e.loginBefore=n,e.loginAfter=a,e.payBefore=o}(t=e.cm||(e.cm={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){var n;!function(t){function n(t,n){function a(e){egretInfo={egretUserId:e.data.id},e.data.result=e.status,n(e.data)}function o(t){1==t.ret?(t.access_token=t.ssid,egret.localStorage.getItem("deviceid")||egret.localStorage.setItem("deviceid",t.deviceid),e.cm.loginAfter(t,a,!1)):n({result:1})}function r(t){console.log("cm old loginHandler1"),console.log(JSON.stringify(t,null,4));var n={};n.access_token=t.cp.token,n.openid=t.user.openid,egret.localStorage.setItem("cm_token",n.access_token),console.log("cm old loginHandler2"),e.cm.loginAfter(n,a,!0)}function i(a){if(0==a.status){var i=a.data;s.client_id=i.client_id,s.client_secret=i.client_secret,s.redirect_uri=i.redirect_uri,e.cm.app.initDesktop({Title:i.title,DetailUrl:i.detailUrl,PicUrl:i.picUrl}),CMGAME_EGRET.checkIsGameSDK(function(n){if(n){console.log("cm old checkIsGameSDK1");var a={clientId:i.client_id,clientSecret:i.client_secret,redirectUri:i.redirect_uri};egret.localStorage.getItem("cm_token"),console.log(JSON.stringify(a,null,4)),console.log("cm old checkIsGameSDK2"),CMGAME_EGRET.dispatchGameLoginData(a,r)}else console.log("cm old checkIsGameSDK2"),e.cm.callRuntime({module:"user",action:"checkLogin",param:t,postData:s},o)})}else n({result:1})}var s={};e.cm.loginBefore(i)}function a(t,n){var a={module:"user",action:"login",param:t};e.cm.callRuntime(a,n)}t.checkLogin=n,t.login=a}(n=t.user||(t.user={}))}(t=e.cm||(e.cm={}))}(nest||(nest={}));var nest;!function(e){var t;!function(t){var n;!function(n){function a(n,a){var o=0,r=-1,i=-2;t.payBefore(n,function(t){if(0==t.status){e.cm.iap.isFirst&&(CMPAY_EGRET.on("cmpay_order_complete",function(e){console.log("cm old solution cmpay_order_complete  "+JSON.stringify(e,null,4)),a(1==e.success?{result:o}:2==e.ret?{result:r}:{result:i})}),e.cm.iap.isFirst=!1);var n={access_token:t.data.access_token,client_id:t.data.client_id,product_id:t.data.product_id,unit:t.data.unit,payload:t.data.payload,notify_url:t.data.notify_url,money:t.data.money,order_name:t.data.order_name,game_icon:t.data.game_icon,game_name:t.data.game_name};CMPAY_EGRET.purchase(n)}else a({result:i})})}n.isFirst=!0,n.pay=a}(n=t.iap||(t.iap={}))}(t=e.cm||(e.cm={}))}(nest||(nest={}));var nest;!function(e){var t;!function(e){var t;!function(e){function t(e){e({status:0,share:0})}e.isSupport=t}(t=e.share||(e.share={}))}(t=e.cm||(e.cm={}))}(nest||(nest={}));var nest;if(function(e){var t;!function(e){var t;!function(e){function t(e){o=e,egret.ExternalInterface.call("save_shortcut_info",JSON.stringify({token:String(Math.random()),value:JSON.stringify(e)}))}function n(e){e(0!=CMPAY_EGRET.getVersion()&&!isNaN(CMPAY_EGRET.getVersion())&&CMPAY_EGRET.getVersion()>301030?{status:0,sendToDesktop:1,attention:0}:{status:0,sendToDesktop:0,attention:0})}function a(e,t){o?(egret.ExternalInterface.call("push_icon",JSON.stringify({title:o.Title,detailUrl:o.DetailUrl,picUrl:o.PicUrl})),t({result:0})):t({result:-1})}var o;e.initDesktop=t,e.isSupport=n,e.sendToDesktop=a}(t=e.app||(e.app={}))}(t=e.cm||(e.cm={}))}(nest||(nest={})),egret.MainContext.runtimeType==egret.MainContext.RUNTIME_NATIVE&&(console.log("cm old 11111 "),console.log(egret_native.getOption("egret.runtime.spid")),console.log(egret_native.getOption("egret.runtime.nest")),console.log("cm old 22222 "),10044==egret_native.getOption("egret.runtime.spid")||!egret_native.getOption("egret.runtime.nest"))){console.log("cm old u r in cm");var appId=351,spId;spId=85==appId||88==appId?10044:18287;var egretInfo;egret_native.setOption("channelTag","liebao"),CMPAY_DEBUG=!1,nest.user.checkLogin=nest.cm.user.checkLogin,nest.iap.pay=nest.cm.iap.pay,nest.share.isSupport=nest.cm.share.isSupport,nest.app.isSupport=nest.cm.app.isSupport,nest.app.sendToDesktop=nest.cm.app.sendToDesktop}"egret_native"in this||(nest.user.checkLogin=function(e,t){EgretH5Sdk.checkLogin(t,this)},nest.user.login=function(e,t){EgretH5Sdk.login(t,this)});var __define=this.__define||function(e,t,n,a){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n,set:a})},nest;!function(e){var t;!function(e){e.uid=void 0,e.appid=parseInt(egret.getOption("appId"))||86}(t=e.h5||(e.h5={}))}(nest||(nest={})),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(nest.user.isSupport=function(e){var t={status:0,result:0,loginType:[],token:void 0};e.call(null,t)},nest.user.checkLogin=function(e,t){var n=function(e){nest.h5.uid=e.id;var n=e.status;nest.h5.uid&&(n=0);var a={status:n,result:n,loginType:void 0,token:e.token};t.call(null,a)};EgretH5Sdk.checkLogin(n,null)},nest.user.login=function(e,t){var n=function(e){nest.h5.uid=e.id;var n=e.status;nest.h5.uid&&(n=0);var a={status:n,result:n,loginType:void 0,token:e.token};t.call(null,a)};EgretH5Sdk.login(n,null,e.loginType)},nest.user.logout=function(e,t){var n=function(e){var n=e.status,a=1==n?0:1;t.call(null,{result:a})};EgretH5Sdk.logout(n,null)},nest.iap.pay=function(e,t){nest.h5.uid&&(e.appId=nest.h5.appid,e.uId=nest.h5.uid,EgretH5Sdk.pay(e,function(e){t(e)},this))},nest.share.isSupport=function(e){var t=function(t){var n=t.status,a={share:n};e.call(null,a)};EgretH5Sdk.isOpenShare(nest.h5.appid,nest.h5.uid,t,null)},nest.share.share=function(e,t){var n=function(e){var n=e.status;0==n?n=-1:1==n&&(n=0);var a={status:n,result:n};t.call(null,a)};EgretH5Sdk.share(nest.h5.appid,nest.h5.uid,e,n,null)},nest.social.isSupport=function(e){e.call(null,{result:0,getFriends:0,openBBS:0})},nest.social.getFriends=function(){},nest.social.openBBS=function(){},nest.app.isSupport=function(e){var t=function(t){var n=t.status,a={attention:n};e.call(null,a)};EgretH5Sdk.isOpenAttention(nest.h5.appid,nest.h5.uid,t,null)},nest.app.attention=function(e,t){EgretH5Sdk.attention(nest.h5.appid,nest.h5.uid),t.call(null,{result:0})},nest.app.sendToDesktop=function(e,t){t.call(null,{result:-1})});